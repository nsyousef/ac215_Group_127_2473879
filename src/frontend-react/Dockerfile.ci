FROM node:18-alpine

# Install Python and build dependencies
RUN apk add --no-cache python3 python3-dev py3-pip

WORKDIR /app

COPY package.json package-lock.json ./

# Install without running postinstall scripts (which tries to set up Python before it's available)
RUN npm ci --ignore-scripts

COPY . .

# Now run the postinstall script that sets up Python environment
RUN node ./scripts/setup-python-env.js

# Run linting and unit tests
# CMD ["npm", "run", "test"]
